<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div class="nav-bar">
        <button id="nav-dash-btn" onclick="location.href='/Dashboard'">Dashboard</button>
        <button id="nav-control-btn" onclick="location.href='/Control'">Control</button>
    </div>
    <div class="container">
        <div class="sub-container">
            <div class="content">
                <div id="temp-box">
                    <h>Temperature</h>
                    <p id="mqttTemp">Tempereture : Loading...</p>
                    <p id="mqttHumid">Humidity : Loading...</p>
                </div>
            </div>
            <div class="content">
                <div id="light-box">
                    <h3>Light Sensor</h3>
                    <div style="display: flex; flex-direction: row; justify-content: space-around; align-items: center;">
                        <p id="mqttLight">Light : </p>
                        <div class="light-sensor-bar">
                            <div id="light-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sub-container">
            <div class="content">
                <div id="vr-box">
                    <h3>VR Sensor</h3>
                    <div style="display: flex; flex-direction: row; justify-content: space-around; align-items: center;">
                        <p id="mqttVr">Sensor Value : </p>
                        <div class="sensor-bar">
                            <div id="vr-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
<script>
    const socket = io(); // ✅ Works now
    socket.on("mqttTemp", (data) => {
        document.getElementById("mqttTemp").textContent = (`Tempereture : ${data} °C / ${((data * 1.8) + 32).toFixed(2)} °F`);
    });

    socket.on("mqttHumid", (data) => {
        document.getElementById("mqttHumid").textContent = (`Humidity : ${data}%`);
    });

    socket.on("mqttLight", (data) => {
        const maxValue = 100; // maximum expected light value
        const fillElement = document.getElementById("light-fill");
        const displayElement = document.getElementById("mqttLight");

        const value = Number(data);

        // calculate percentage of the bar
        let percent = (value / maxValue) * 100;
        if (percent > 100) percent = 100; // clamp to 100%

        fillElement.style.width = percent + "%";
    });

    socket.on("mqttVr", (data) => {
        const maxValue = 100; // maximum expected sensor value
        const fillElement = document.getElementById("vr-fill");
        const value = Number(data);

        // calculate percentage of the bar
        let percent = (value / maxValue) * 100;
        if (percent > 100) percent = 100; // clamp to 100%

        fillElement.style.width = percent + "%";
    });
</script>
</html>